<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nguyen The Thong</title>
    <style>
        *{box-sizing:border-box;margin:0;padding:0}
        body{font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;padding:28px}
        .container{max-width:1200px;margin:0 auto;background:rgba(255,255,255,0.98);border-radius:16px;padding:18px;box-shadow:0 20px 60px rgba(0,0,0,.25)}
        h1{text-align:center;color:#333;margin-bottom:18px;font-size:2rem;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent}

        /* Grid layout: left sidebar (cities) + right main (weather) */
        .grid{display:grid;grid-template-columns:320px 1fr;gap:20px}

        /* Sidebar */
        .sidebar{background:#fff;border-radius:12px;padding:14px;box-shadow:0 8px 24px rgba(0,0,0,.06);display:flex;flex-direction:column}
        .search{display:flex;gap:8px;margin-bottom:12px}
        .search input{flex:1;padding:8px 10px;border:2px solid #e6e9ec;border-radius:8px;font-size:0.95rem}
        .city-list{overflow:auto;border-top:1px solid #f0f0f0;padding-top:8px}
        .city-item{padding:10px;border-radius:8px;cursor:pointer;color:#333;font-weight:600;border:1px solid transparent;margin-bottom:8px}
        .city-item:hover{background:linear-gradient(90deg,#f4f6ff,#eef2ff);transform:translateX(4px)}
        .city-item.active{background:linear-gradient(90deg,#667eea,#764ba2);color:white;border-color:rgba(0,0,0,0.03)}

        /* Main weather area */
        .main{display:flex;flex-direction:column;gap:18px}
        .current-weather{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;padding:26px;border-radius:12px;display:flex;gap:18px;align-items:center}
        .current-left{flex:1}
        .current-right{width:120px;text-align:center}
        .temp{font-size:3.6rem;font-weight:700}
        .desc{font-size:1.1rem;text-transform:capitalize;margin-bottom:6px}
        .small{font-size:0.95rem;opacity:.95}

        .details{display:flex;gap:12px;flex-wrap:wrap;margin-top:12px}
        .detail-item{background:rgba(255,255,255,0.12);padding:8px 12px;border-radius:8px}

        .hourly-forecast{background:#fff;border-radius:12px;padding:14px;box-shadow:0 8px 20px rgba(0,0,0,.05)}
        .hourly-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:12px}
        .hour-card{background:linear-gradient(180deg,#f8fafc,#eef3ff);padding:12px;border-radius:8px;text-align:center}
        .hour-card .hour-temp{font-weight:700;margin:8px 0}

        .loading,.error{text-align:center;padding:12px;border-radius:10px}
        .loading{color:#667eea}
        .error{background:#fff0f0;border:1px solid #ffd6d6;color:#a33}

        @media(max-width:880px){.grid{grid-template-columns:1fr}.sidebar{order:2}.main{order:1}}
    </style>
</head>
<body>
    <div class="container">
        <h1>üå§Ô∏è D·ª± B√°o Th·ªùi Ti·∫øt Vi·ªát Nam</h1>
        
        <div class="grid">
            <aside class="sidebar" aria-label="Danh s√°ch t·ªânh th√†nh">
                <div class="search">
                    <input id="citySearch" placeholder="T√¨m t·ªânh/th√†nh..." aria-label="T√¨m t·ªânh" />
                    <button id="resetBtn" title="Hi·ªán t·∫•t c·∫£">‚ü≥</button>
                </div>
                <div id="cityList" class="city-list" role="listbox" tabindex="0" style="max-height:60vh"></div>
            </aside>

            <main class="main">
                <div id="loadingDiv" class="loading" style="display:none">‚è≥ ƒêang t·∫£i d·ªØ li·ªáu th·ªùi ti·∫øt...</div>
                <div id="errorDiv" class="error" style="display:none"></div>

                <section id="weatherContainer" class="weather-area" style="display:none">
                    <div class="current-weather">
                        <div class="current-left">
                            <div class="small">D·ª± b√°o cho</div>
                            <h2 id="cityName">-</h2>
                            <div class="desc" id="currentDesc"></div>
                            <div class="temp" id="currentTemp">--¬∞C</div>
                            <div class="details">
                                <div class="detail-item"><span class="small">üíß ƒê·ªô ·∫©m</span><div id="humidity">-</div></div>
                                <div class="detail-item"><span class="small">üí® Gi√≥</span><div id="windSpeed">-</div></div>
                                <div class="detail-item"><span class="small">üå°Ô∏è C·∫£m gi√°c</span><div id="feelsLike">-</div></div>
                                <div class="detail-item"><span class="small">üëÅÔ∏è T·∫ßm nh√¨n</span><div id="visibility">-</div></div>
                            </div>
                        </div>
                        <div class="current-right">
                            <img id="currentIcon" src="" alt="Icon" style="width:96px;height:96px;object-fit:contain;display:block;margin:0 auto"/>
                        </div>
                    </div>

                    <div class="hourly-forecast">
                        <h3 style="margin:8px 0 14px 0">D·ª± b√°o theo gi·ªù</h3>
                        <div id="hourlyGrid" class="hourly-grid"></div>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <script>
        // D·ªØ li·ªáu t·ªânh th√†nh Vi·ªát Nam v·ªõi ID t·ª´ cnnd.vn
        const cities = [
            {id: '2347719', name: 'An Giang'},
            {id: '20070078', name: 'B√¨nh D∆∞∆°ng'},
            {id: '20070086', name: 'B√¨nh Ph∆∞·ªõc'},
            {id: '2347731', name: 'B√¨nh Thu·∫≠n'},
            {id: '2347730', name: 'B√¨nh ƒê·ªãnh'},
            {id: '20070081', name: 'B·∫°c Li√™u'},
            {id: '20070087', name: 'B·∫Øc Giang'},
            {id: '20070084', name: 'B·∫Øc K·∫°n'},
            {id: '20070088', name: 'B·∫Øc Ninh'},
            {id: '2347703', name: 'B·∫øn Tre'},
            {id: '2347704', name: 'Cao B·∫±ng'},
            {id: '20070082', name: 'C√† Mau'},
            {id: '2347732', name: 'C·∫ßn Th∆°'},
            {id: '28301718', name: 'ƒêi·ªán Bi√™n'},
            {id: '20070085', name: 'ƒê√† N·∫µng'},
            {id: '1252375', name: 'ƒê√† L·∫°t'},
            {id: '2347720', name: 'ƒê·∫Øk L·∫Øk'},
            {id: '28301719', name: 'ƒê·∫Øk N√¥ng'},
            {id: '2347721', name: 'ƒê·ªìng Nai'},
            {id: '2347722', name: 'ƒê·ªìng Th√°p'},
            {id: '2347733', name: 'Gia Lai'},
            {id: '2347727', name: 'H√† N·ªôi'},
            {id: '2347728', name: 'TP. H·ªì Ch√≠ Minh'},
            {id: '2347734', name: 'H√† Giang'},
            {id: '2347741', name: 'H√† Nam'},
            {id: '2347736', name: 'H√† Tƒ©nh'},
            {id: '2347737', name: 'H√≤a B√¨nh'},
            {id: '20070079', name: 'H∆∞ng Y√™n'},
            {id: '20070080', name: 'H·∫£i D∆∞∆°ng'},
            {id: '2347707', name: 'H·∫£i Ph√≤ng'},
            {id: '28301720', name: 'H·∫≠u Giang'},
            {id: '2347738', name: 'Kh√°nh H√≤a'},
            {id: '2347723', name: 'Ki√™n Giang'},
            {id: '20070076', name: 'Kon Tum'},
            {id: '2347708', name: 'Lai Ch√¢u'},
            {id: '2347710', name: 'Long An'},
            {id: '2347740', name: 'L√†o Cai'},
            {id: '2347709', name: 'L√¢m ƒê·ªìng'},
            {id: '2347718', name: 'L·∫°ng S∆°n'},
            {id: '20070089', name: 'Nam ƒê·ªãnh'},
            {id: '2347742', name: 'Ngh·ªá An'},
            {id: '2347743', name: 'Ninh B√¨nh'},
            {id: '2347744', name: 'Ninh Thu·∫≠n'},
            {id: '20070091', name: 'Ph√∫ Th·ªç'},
            {id: '2347745', name: 'Ph√∫ Y√™n'},
            {id: '2347746', name: 'Qu·∫£ng B√¨nh'},
            {id: '2347711', name: 'Qu·∫£ng Nam'},
            {id: '20070077', name: 'Qu·∫£ng Ng√£i'},
            {id: '2347712', name: 'Qu·∫£ng Ninh'},
            {id: '2347747', name: 'Qu·∫£ng Tr·ªã'},
            {id: '2347748', name: 'S√≥c TrƒÉng'},
            {id: '2347713', name: 'S∆°n La'},
            {id: '2347715', name: 'Thanh H√≥a'},
            {id: '2347716', name: 'Th√°i B√¨nh'},
            {id: '20070083', name: 'Th√°i Nguy√™n'},
            {id: '2347749', name: 'Th·ª´a Thi√™n Hu·∫ø'},
            {id: '2347717', name: 'Ti·ªÅn Giang'},
            {id: '2347750', name: 'Tr√† Vinh'},
            {id: '2347751', name: 'Tuy√™n Quang'},
            {id: '2347714', name: 'T√¢y Ninh'},
            {id: '2347752', name: 'Vƒ©nh Long'},
            {id: '20070090', name: 'Vƒ©nh Ph√∫c'},
            {id: '2347729', name: 'V≈©ng T√†u'},
            {id: '2347753', name: 'Y√™n B√°i'}
        ];

        // API URL base (kept for reference)
        const WEATHER_API_BASE = 'https://utils3.cnnd.vn/ajax/weatherinfo/';

        // Elements
        const cityListEl = document.getElementById('cityList');
        const citySearch = document.getElementById('citySearch');
        const resetBtn = document.getElementById('resetBtn');
        const loadingDiv = document.getElementById('loadingDiv');
        const errorDiv = document.getElementById('errorDiv');

        // Render the city list (filter optional)
        function renderCityList(filter = ''){
            cityListEl.innerHTML = '';
            const normalizedFilter = filter.trim().toLowerCase();
            cities.forEach(city => {
                if (normalizedFilter && !city.name.toLowerCase().includes(normalizedFilter)) return;
                const div = document.createElement('div');
                div.className = 'city-item';
                div.textContent = city.name;
                div.dataset.id = city.id;
                div.setAttribute('role','option');
                div.addEventListener('click', () => selectCity(city.id, city.name, div));
                cityListEl.appendChild(div);
            });
        }

        // Set active visual state on selected city element
        function setActiveElement(el){
            document.querySelectorAll('.city-item').forEach(item => item.classList.remove('active'));
            if(el) el.classList.add('active');
        }

        // When a city is chosen from sidebar
        function selectCity(id, name, el){
            setActiveElement(el);
            getWeatherData(id, name);
        }

        // Hook up search and reset
        citySearch.addEventListener('input', (e) => renderCityList(e.target.value));
        resetBtn.addEventListener('click', () => { citySearch.value=''; renderCityList(); citySearch.focus(); });

        // H√†m l·∫•y d·ªØ li·ªáu th·ªùi ti·∫øt b·∫±ng c√°ch s·ª≠ d·ª•ng proxy (allorigins)
        async function getWeatherData(cityId, cityName) {
            const weatherContainer = document.getElementById('weatherContainer');
            loadingDiv.style.display = 'block';
            errorDiv.style.display = 'none';
            weatherContainer.style.display = 'none';

            try {
                const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent('https://utils3.cnnd.vn/ajax/weatherinfo/' + cityId + '.htm')}`;
                console.log('Fetching weather for:', cityName, proxyUrl);

                const response = await fetch(proxyUrl);
                if (!response.ok) throw new Error(`Kh√¥ng th·ªÉ l·∫•y d·ªØ li·ªáu (Status: ${response.status})`);

                const result = await response.json();
                const apiData = JSON.parse(result.contents);

                if (!apiData.Data || !apiData.Data.data || !apiData.Data.data.datainfo) throw new Error('Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu th·ªùi ti·∫øt');

                const weatherInfo = apiData.Data.data.datainfo;
                displayWeather(weatherInfo, cityName);
            } catch (error) {
                console.error('Error:', error);
                errorDiv.textContent = `‚ùå L·ªói: ${error.message}`;
                errorDiv.style.display = 'block';
            } finally {
                loadingDiv.style.display = 'none';
            }
        }

        // Hi·ªÉn th·ªã th√¥ng tin th·ªùi ti·∫øt (gi·ªØ logic gi·ªëng tr∆∞·ªõc)
        function displayWeather(weatherInfo, cityName) {
            document.getElementById('cityName').textContent = cityName;
            document.getElementById('currentTemp').textContent = (weatherInfo.temperature ?? '--') + '¬∞C';
            document.getElementById('currentDesc').textContent = weatherInfo.status || 'Kh√¥ng r√µ';

            const iconElement = document.getElementById('currentIcon');
            if (weatherInfo.shadow_icon) { iconElement.src = weatherInfo.shadow_icon; iconElement.style.display='block'; }
            else { iconElement.style.display='none'; }

            document.getElementById('humidity').textContent = weatherInfo.humidity ?? 'N/A';
            document.getElementById('windSpeed').textContent = weatherInfo.wind ? `${weatherInfo.wind.index} ${weatherInfo.wind.unit}` : 'N/A';
            document.getElementById('feelsLike').textContent = weatherInfo.feels_like ? `${weatherInfo.feels_like}¬∞C` : 'N/A';
            document.getElementById('visibility').textContent = weatherInfo.visibility ? `${weatherInfo.visibility.index} ${weatherInfo.visibility.unit}` : 'N/A';

            const hourlyGrid = document.getElementById('hourlyGrid');
            hourlyGrid.innerHTML = '';
            if (Array.isArray(weatherInfo.hourly_temperature) && weatherInfo.hourly_temperature.length) {
                weatherInfo.hourly_temperature.forEach(item => {
                    const hourCard = document.createElement('div');
                    hourCard.className = 'hour-card';
                    const img = item.shadow_icon ? `<img src="${item.shadow_icon}" alt="icon" style="width:48px;height:48px;object-fit:contain">` : '';
                    hourCard.innerHTML = `
                        <div class="time">${item.time}:00</div>
                        ${img}
                        <div class="hour-temp">${item.temperature}¬∞C</div>
                        <div class="hour-desc">${item.status || ''}</div>
                    `;
                    hourlyGrid.appendChild(hourCard);
                });
            } else {
                hourlyGrid.innerHTML = '<div style="padding:12px">Kh√¥ng c√≥ d·ªØ li·ªáu theo gi·ªù</div>';
            }

            document.getElementById('weatherContainer').style.display = 'block';
        }

        // Kh·ªüi t·∫°o: render danh s√°ch v√† t·ª± load H√† N·ªôi
        window.addEventListener('load', () => {
            renderCityList();
            const hanoiCity = cities.find(c => c.name === 'H√† N·ªôi');
            if (hanoiCity) {
                // highlight H√† N·ªôi in the list
                const firstEl = document.querySelector(`.city-item[data-id="${hanoiCity.id}"]`);
                if (firstEl) setActiveElement(firstEl);
                getWeatherData(hanoiCity.id, hanoiCity.name);
            }
        });
    </script>
</body>
</html>